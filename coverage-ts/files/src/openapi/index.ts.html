
  <!DOCTYPE html>
  <html>
    <head>
      <title>index.ts</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="positive"><td class="">src/openapi/index.ts</td><td class="">91.44%</td><td class="">80%</td><td class="">257</td><td class="">235</td><td class="">22</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">import { validate } from &quot;@mintlify/openapi-parser&quot;;
import axios, { isAxiosError } from &quot;axios&quot;;
import dashify from &quot;dashify&quot;;
import fs from &quot;node:fs&quot;;
import { getFileId } from &quot;../utils.js&quot;;
import { McpServer } from &quot;@modelcontextprotocol/sdk/server/mcp.js&quot;;
import {
  convertEndpointToCategorizedZod,
  convertStrToTitle,
  findNextIteration,
  getEndpointsFromOpenApi,
  loadEnv,
  getValFromNestedJson,
} from &quot;./helpers.js&quot;;

interface SecurityParam {
  type: &quot;apiKey&quot; | &quot;http&quot; | &quot;oauth2&quot;;
}

interface Endpoint {
  url?: string;
  method: string;
  path: any;
  title?: string;
  description?: string;
  request: {
    security: Array&lt;{
      parameters: {
        header: Record&lt;string, SecurityParam | any&gt;;
      };
    }&gt;;
  };
  servers: Array&lt;{ url: string }&gt;; // Ensure &#x27;servers&#x27; is optional
  operation: string; // Ensure &#x27;operation&#x27; is optional
}

export async function createToolsFromOpenApi(
  openApiPath: string,
  index: number,
  server: McpServer,
  existingTools: Set&lt;string&gt;
): Promise&lt;void&gt; {
  let openapi: string;
  try {
    openapi = fs.readFileSync(openApiPath, &quot;utf8&quot;);
  } catch (error) {
    // No OpenAPI file found, skip
    return;
  }

  const { valid, errors, specification } = await validate(openapi);

  if (!valid || !specification) {
    console.error(&quot;Invalid OpenAPI file:&quot;, errors);
    return;
  }

  if (!specification.paths) {
    console.error(&quot;Specification paths are undefined.&quot;);
    return;
  }
  if (!specification.paths) {
    console.error(&quot;Specification paths are undefined.&quot;);
    return;
  }
  const endpoints: Endpoint[] = getEndpointsFromOpenApi({
    ...specification,
    paths: (specification.paths || {}) as {
      [path: string]: { [method: string]: any };
    },
  });
  const endpointId = String(getFileId(specification, index));
  const envVars = loadEnv(endpointId);

  endpoints.forEach((endpoint: Endpoint) =&gt; {
    const {
      url: urlSchema,
      method: methodSchema,
      paths: pathsSchema,
      queries: queriesSchema,
      body: bodySchema,
      headers: headersSchema,
      cookies: cookiesSchema,
    } = convertEndpointToCategorizedZod(endpointId, endpoint);

    const serverArgumentsSchemas = {
      ...pathsSchema,
      ...queriesSchema,
      ...bodySchema,
      ...headersSchema,
      ...cookiesSchema,
    };

    if (!endpoint.title) {
      endpoint.title = `${endpoint.method} ${convertStrToTitle(endpoint.path)}`;
    }

    if (existingTools.has(endpoint.title)) {
      const lastCount = findNextIteration(existingTools, endpoint.title);
      endpoint.title = `${endpoint.title}---${lastCount}`;
    }

    if (endpoint.title.length &gt; 64) {
      endpoint.title = endpoint.title.slice(0, 64);
    }

    existingTools.add(endpoint.title);

    server.tool(
      dashify(endpoint.title),
      endpoint.description || endpoint.title,
      serverArgumentsSchemas,
      async (inputArgs: Record&lt;string, any&gt;) =&gt; {
        const inputParams: Record&lt;string, any&gt; = {};
        const inputHeaders: Record&lt;string, any&gt; = {};
        const inputCookies: Record&lt;string, any&gt; = {};
        let urlWithPathParams = urlSchema;
        let inputBody: any = undefined;

        if (&quot;body&quot; in inputArgs) {
          inputBody = inputArgs.body;
          delete inputArgs.body;
        }

        for (const [key, value] of Object.entries(inputArgs)) {
          if (key in pathsSchema) {
            urlWithPathParams = urlWithPathParams.replace(`{${key}}`, value);
          } else if (key in queriesSchema) {
            inputParams[key] = value;
          } else if (key in headersSchema) {
            inputHeaders[key] = value;
          } else if (key in cookiesSchema) {
            inputCookies[key] = value;
          }
        }

        const security = endpoint.request.security?.[0]?.parameters;
        if (security?.header) {
          for (const [key, value] of Object.entries(security.header)) {
            let envKey = &quot;&quot;;
            if (value.type === &quot;apiKey&quot;) {
              envKey = `header.${key}.API_KEY`;
            } else if (value.type === &quot;http&quot;) {
              envKey = `header.${key}.HTTP`;
            }

            const envVal = getValFromNestedJson(envKey, envVars);
            if (envVal) {
              inputHeaders[key] = envVal;
            }
          }
        }

        const requestConfig = {
          method: methodSchema,
          url: urlWithPathParams,
          params: inputParams,
          data: inputBody,
          headers: inputHeaders,
          withCredentials: true,
        };

        try {
          const response = await axios(requestConfig);
          return response.data;
        } catch (error) {
          if (isAxiosError(error)) {
            return {
              error: true,
              message: error.response?.data || error.message,
            };
          }
          return {
            error: true,
            message: &quot;Unknown error occurred&quot;,
          };
        }
      }
    );
  });
}
</textarea><pre id="annotations" style="display:none">[{&quot;file&quot;:&quot;src/openapi/index.ts&quot;,&quot;line&quot;:22,&quot;character&quot;:2,&quot;text&quot;:&quot;path&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/openapi/index.ts&quot;,&quot;line&quot;:94,&quot;character&quot;:72,&quot;text&quot;:&quot;path&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/openapi/index.ts&quot;,&quot;line&quot;:117,&quot;character&quot;:12,&quot;text&quot;:&quot;inputBody&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/openapi/index.ts&quot;,&quot;line&quot;:120,&quot;character&quot;:10,&quot;text&quot;:&quot;inputBody&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/openapi/index.ts&quot;,&quot;line&quot;:120,&quot;character&quot;:32,&quot;text&quot;:&quot;body&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/openapi/index.ts&quot;,&quot;line&quot;:121,&quot;character&quot;:27,&quot;text&quot;:&quot;body&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/openapi/index.ts&quot;,&quot;line&quot;:124,&quot;character&quot;:25,&quot;text&quot;:&quot;value&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/openapi/index.ts&quot;,&quot;line&quot;:128,&quot;character&quot;:31,&quot;text&quot;:&quot;value&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/openapi/index.ts&quot;,&quot;line&quot;:130,&quot;character&quot;:32,&quot;text&quot;:&quot;value&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/openapi/index.ts&quot;,&quot;line&quot;:132,&quot;character&quot;:32,&quot;text&quot;:&quot;value&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/openapi/index.ts&quot;,&quot;line&quot;:138,&quot;character&quot;:27,&quot;text&quot;:&quot;value&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/openapi/index.ts&quot;,&quot;line&quot;:140,&quot;character&quot;:16,&quot;text&quot;:&quot;value&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/openapi/index.ts&quot;,&quot;line&quot;:140,&quot;character&quot;:22,&quot;text&quot;:&quot;type&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/openapi/index.ts&quot;,&quot;line&quot;:142,&quot;character&quot;:23,&quot;text&quot;:&quot;value&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/openapi/index.ts&quot;,&quot;line&quot;:142,&quot;character&quot;:29,&quot;text&quot;:&quot;type&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/openapi/index.ts&quot;,&quot;line&quot;:146,&quot;character&quot;:18,&quot;text&quot;:&quot;envVal&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/openapi/index.ts&quot;,&quot;line&quot;:147,&quot;character&quot;:16,&quot;text&quot;:&quot;envVal&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/openapi/index.ts&quot;,&quot;line&quot;:148,&quot;character&quot;:34,&quot;text&quot;:&quot;envVal&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/openapi/index.ts&quot;,&quot;line&quot;:157,&quot;character&quot;:10,&quot;text&quot;:&quot;data&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/openapi/index.ts&quot;,&quot;line&quot;:157,&quot;character&quot;:16,&quot;text&quot;:&quot;inputBody&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/openapi/index.ts&quot;,&quot;line&quot;:164,&quot;character&quot;:26,&quot;text&quot;:&quot;data&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/openapi/index.ts&quot;,&quot;line&quot;:169,&quot;character&quot;:39,&quot;text&quot;:&quot;data&quot;,&quot;kind&quot;:1}]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Thu, 22 May 2025 12:43:43 GMT</p>
    </body>
  </html>
  