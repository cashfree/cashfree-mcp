
  <!DOCTYPE html>
  <html>
    <head>
      <title>config.ts</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="positive"><td class="">src/config.ts</td><td class="">100.00%</td><td class="">80%</td><td class="">133</td><td class="">133</td><td class="">0</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">/**
 * Reads and prepares configuration for Cashfree APIs (Payment, Payout, Verification).
 * Handles environment-based base URLs and API credentials.
 */

import { getPublicKeyFromPath } from &quot;./openapi/helpers.js&quot;;

export interface ApiConfig {
  base_url?: string;
  header: {
    &quot;x-client-id&quot;?: string;
    &quot;x-client-secret&quot;?: string;
  };
  TWO_FA_PUBLIC_KEY?: string;
}

export type Config = Record&lt;
  typeof PAYMENT_API_KEY | typeof PAYOUT_API_KEY | typeof VERIFICATION_API_KEY,
  ApiConfig
&gt;;

const BASE_URLS = {
  sandbox: &quot;https://sandbox.cashfree.com&quot;,
  production: &quot;https://api.cashfree.com&quot;,
};

// API Keys / Identifiers
export const PAYMENT_API_KEY = &quot;Cashfree Payment Gateway APIs - 2025-01-01&quot;;
export const PAYOUT_API_KEY = &quot;Cashfree Payout APIs - 2024-01-01&quot;;
export const VERIFICATION_API_KEY = &quot;Cashfree Verification API&#x27;s. - 2023-12-18&quot;;

// Default config structure
const DEFAULT_CONFIG: Config = {
  [PAYMENT_API_KEY]: {
    base_url: `${BASE_URLS.sandbox}/pg`,
    header: {},
  },
  [PAYOUT_API_KEY]: {
    base_url: `${BASE_URLS.sandbox}/payout`,
    header: {},
  },
  [VERIFICATION_API_KEY]: {
    base_url: `${BASE_URLS.sandbox}/verification`,
    header: {},
  },
};

export function readConfig(): Config {
  const config: Config = JSON.parse(JSON.stringify(DEFAULT_CONFIG));
  const isProduction = process.env.ENV === &quot;production&quot;;
  const baseUrl = isProduction ? BASE_URLS.production : BASE_URLS.sandbox;

  // Replace sandbox base_url with the correct environment URL
  Object.entries(config).forEach(([_, apiConfig]) =&gt; {
    const suffix = apiConfig.base_url?.split(BASE_URLS.sandbox)[1] ?? &quot;&quot;;
    apiConfig.base_url = `${baseUrl}${suffix}`;
  });

  // Helper to configure API credentials
  const configureApiCredentials = ({
    key,
    idVar,
    secretVar,
    pubKeyVar,
  }: {
    key: keyof Config;
    idVar: string;
    secretVar: string;
    pubKeyVar?: string;
  }) =&gt; {
    const appId = process.env[idVar];
    const appSecret = process.env[secretVar];
    if (appId &amp;&amp; appSecret) {
      config[key].header = {
        &quot;x-client-id&quot;: appId,
        &quot;x-client-secret&quot;: appSecret,
      };
    }

    if (pubKeyVar) {
      const publicKeyPath = process.env[pubKeyVar];
      if (publicKeyPath) {
        const publicKey = getPublicKeyFromPath(publicKeyPath);
        config[key].TWO_FA_PUBLIC_KEY =
          publicKey === null ? undefined : publicKey;
      }
    }
  };

  // Apply credentials to each API config
  (
    [
      {
        key: PAYMENT_API_KEY,
        idVar: &quot;PAYMENTS_APP_ID&quot;,
        secretVar: &quot;PAYMENTS_APP_SECRET&quot;,
      },
      {
        key: PAYOUT_API_KEY,
        idVar: &quot;PAYOUTS_APP_ID&quot;,
        secretVar: &quot;PAYOUTS_APP_SECRET&quot;,
        pubKeyVar: &quot;TWO_FA_PUBLIC_KEY_PEM_PATH&quot;,
      },
      {
        key: VERIFICATION_API_KEY,
        idVar: &quot;SECUREID_APP_ID&quot;,
        secretVar: &quot;SECUREID_APP_SECRET&quot;,
        pubKeyVar: &quot;TWO_FA_PUBLIC_KEY_PEM_PATH&quot;,
      },
    ] as {
      key:
        | typeof PAYMENT_API_KEY
        | typeof PAYOUT_API_KEY
        | typeof VERIFICATION_API_KEY;
      idVar: string;
      secretVar: string;
      pubKeyVar?: string;
    }[]
  ).forEach(configureApiCredentials);

  return config;
}
</textarea><pre id="annotations" style="display:none">[]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Tue, 03 Jun 2025 11:33:38 GMT</p>
    </body>
  </html>
  